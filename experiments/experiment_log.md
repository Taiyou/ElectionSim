# 選挙シミュレーション 実験ログ

## プロジェクト概要

2026年2月8日投開票の衆議院選挙を対象に、ペルソナベースの投票行動シミュレーションを行う。
289小選挙区 + 11比例ブロック（465議席）を対象。

## 実験設計の変遷

### Phase 1: ルールベース（v1〜v3c）

全てのペルソナの投票行動を **6要因加重モデル + ガウシアンノイズ** で決定。
LLM呼び出しなし。パラメータ（重み、スイングオフセット等）の調整のみで条件を変化。

| 実験 | 方式 | 選挙区 | シード | 主な変更点 |
|------|------|--------|--------|-----------|
| v1 | ルールベース | 10 (パイロット) | 42 | ベースライン |
| v2 | ルールベース | 289 (全区) | 42,123,7,99,314 | v1の全区展開 |
| v3a | ルールベース | 289 | 42,99,123 | policy_alignment ↑0.35, party_loyalty ↓0.20 |
| v3b | ルールベース | 289 | 42,99,123 | party_loyalty ↓0.15, swing_noise +0.05 |
| v3c | ルールベース | 289 | 42,99,123 | turnout_boost +0.08 |

**Phase 1の限界**: ペルソナは属性を持つが、意思決定はルール（加重スコア）で行われる。
ペルソナの職業・関心事・情報源は生成されるが、投票決定には直接使われていない。
事実上「電卓」であり「ペルソナAI」ではない。

---

### Phase 2: LLMペルソナ実験（v4〜v7）— 2026-02-08開始

**目的**: ペルソナの投票行動をLLM（Claude）に委ねることで、ルールベースでは捕捉できない
「人間らしい」意思決定プロセスを再現し、ルールベースとの差分を分析する。

**設計原則**:
1. **ペルソナ固定**: 全実験で同一シード・同一分布からペルソナを生成し、意思決定メカニズムのみを変える
2. **候補者固定**: `candidates.csv`の実在候補者データをそのまま使用
3. **比較可能性**: v2（ルールベース全区）を共通ベースラインとし、選挙区・ペルソナレベルで差分比較
4. **再現性**: シード、プロンプト、モデル、温度パラメータを全て記録

#### 候補者データの扱い

- `backend/app/data/candidates.csv`: 289選挙区、1,120名+の実在候補者
- フィールド: candidate_name, party_id, status (incumbent/former/new), previous_wins, dual_candidacy
- 各選挙区3〜6名
- LLMプロンプトには候補者名・政党・現職/新人・当選回数を含める

#### ペルソナ分布の扱い

- `persona_data/districts/all_districts_persona_data.csv`: 289選挙区ごとの15アーキタイプ構成比率
- 同一シード（seed=42）で生成した100ペルソナ/選挙区を全実験で共有
- ペルソナ属性: archetype_id, age, gender, occupation, political_engagement, turnout_probability,
  swing_tendency, top_concerns, information_sources, party_affinity, ideology
- LLMプロンプトにはこれらの属性を全て含めて「なりきり」を促す

#### 実験一覧

| 実験 | 方式 | 選挙区 | シード | コンセプト | 推定コスト |
|------|------|--------|--------|-----------|-----------|
| **v4a** | LLM全ペルソナ | 10 (パイロット) | 42 | ペルソナになりきって投票判断 | ~$5-10 |
| **v4b** | LLM全ペルソナ | 289 (全区) | 42,99,123 | v4aの全区展開 | ~$30-60 |
| **v5a** | ペルソナ間議論 | 10 (パイロット) | 42 | 5人グループで議論後に投票 | ~$15-25 |
| **v6a** | 時系列イベント反応 | 10 (パイロット) | 42 | 5日間のニュースに反応しつつ投票 | ~$20-30 |
| **v7a** | 理由付き投票 | 289 (全区) | 42 | 投票理由を自然言語で説明 | ~$40-60 |

---

## 実験詳細

### v4a: LLMペルソナ投票（パイロット10区）

- **開始日時**: 2026-02-08
- **仮説**: LLMペルソナはルールベースと比較して、(1)スイング層の投票先がより多様化し、
  (2)候補者個人の属性（当選回数、政策アピール）により敏感に反応する
- **方法**: 10選挙区 × 100ペルソナ = 1,000回のLLM呼び出し（15人/バッチ → 約67バッチ）
- **モデル**: anthropic/claude-sonnet-4 (via OpenRouter), temperature=0.7
- **実行ID**: v4_20260208_105645_seed42
- **実行時間**: 1113.9秒（約19分）
- **結果**:
  - 投票率: 75.5%（v1ルールベースの54.6%より大幅に高い）
  - 議席: chudo 5, ldp 4, ishin 1
  - LLMは投票率を高く見積もる傾向（ペルソナの「投票に行く意志」を過大評価か）

| 選挙区 | v4a (LLM) | v1 (ルールベース) | 差分 |
|--------|-----------|-----------------|------|
| 北海道11区 | chudo (僅差1票) | chudo | 一致 |
| 秋田1区 | ldp (11票差) | ldp | 一致 |
| 東京1区 | chudo (12票差) | ldp | **不一致** |
| 神奈川1区 | chudo (32票差) | ishin | **不一致** |
| 愛知1区 | chudo (15票差) | ldp | **不一致** |
| 京都1区 | chudo (5票差) | jcp | **不一致** |
| 大阪1区 | ishin (26票差) | ishin | 一致 |
| 島根1区 | ldp (20票差) | ldp | 一致 |
| 福岡1区 | ldp (3票差) | ldp | 一致 |
| 沖縄1区 | ldp (11票差) | ldp | **不一致**（v1はldp） |

- **v1との一致率**: 6/10 (60%)
- **主な差分の分析**:
  1. LLMはchudo（中道改革連合）に有利な判断をする傾向（v1: 1議席 → v4a: 5議席）
  2. 都市部の接戦区（東京、神奈川、愛知、京都）でLLMは野党寄りの判断
  3. 農村・保守地盤（秋田、島根）ではルールベースと一致
  4. LLMは投票率を75.5%と高く予測（v1: 54.6%）— 天候影響の過小評価か

### v4b: LLM全289区

- **開始日時**: (実行時に記入)
- **仮説**: v4aで確認したLLMの特性が全国レベルで議席数にどう影響するか
- **方法**: 289選挙区 × 100ペルソナ × 3シード = 86,700回のLLM呼び出し（Batch API）
- **結果**: (実行後に記入)

### v5a: ペルソナ間議論シミュレーション（パイロット10区）

- **開始日時**: (実行時に記入)
- **仮説**: 議論を経ることで、(1)スイング層は議論相手の影響を受けて投票先が変わり、
  (2)固定層は変わらない。SNS/口コミの影響をモデル化できる
- **方法**: 10区 × 10グループ × 5人/グループ × 3ターン議論 → 投票
- **結果**: (実行後に記入)

### v6a: ニュース・イベント時系列反応（パイロット10区）

- **開始日時**: (実行時に記入)
- **仮説**: 選挙期間中のイベント（スキャンダル、政策発表等）によりペルソナの支持が動的に変化する
- **方法**: 10区 × 100ペルソナ × 5日分のイベント提示
- **イベント設計**: 架空の5日間シナリオ（経済ニュース、スキャンダル、討論会、SNS炎上、投票日天候）
- **結果**: (実行後に記入)

### v7a: 理由付き投票（全289区）

- **開始日時**: (実行時に記入)
- **仮説**: LLMに投票理由を説明させることで、出口調査に匹敵する定性データが得られる
- **方法**: 289区 × 100ペルソナ、各ペルソナが投票先 + 理由（50-150字）を返す
- **結果**: (実行後に記入)

---

## 選挙後の比較計画

選挙結果が判明した後、以下の指標で全実験を比較する:

1. **選挙区一致率** (`winner_match_rate`): 当選者の政党が一致した割合
2. **議席MAE** (`seat_mae`): 政党別議席数の平均絶対誤差
3. **投票率相関** (`turnout_correlation`): 選挙区別投票率のピアソン相関
4. **接戦区精度** (`battleground_accuracy`): 票差5%以内の接戦区での正答率
5. **定性比較**: v7aの投票理由と実際の出口調査データの比較

### 比較コマンド

```bash
# 実選挙結果の投入
python scripts/load_actual_results.py --csv actual_results.csv

# 各実験との比較
python scripts/run_experiment.py --compare-actual <experiment_id>

# 全実験一括比較
python scripts/run_experiment.py --compare-all-actual
```
